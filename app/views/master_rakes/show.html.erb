<div class="container-fluid">
<%= render 'master_rakes/master_rakes_menu' %>
<div class="row">
  <div class="col-md-3">
    <h5>
      <small>
      <%= link_to "MASTER RAKES", master_rakes_path %> | <%= link_to Category.find(@rake.category_id).desc.upcase, master_rakes_path(category_id: @rake.category_id) %>
      </small>
    </h5>
  
    <p>
      <% if !current_user.nil? %>
        <% if !@custom_rake.empty? %>
          <%= link_to "<i class='fa fa-leaf white'></i>".html_safe + " Show my Rake",
                      rake_path(@custom_rake.first),
                      class: "btn btn-primary btn-block" %>
        <% else %>
          <%= link_to "<i class='fa fa-plus white'></i>".html_safe + " Create Customized Rake",
                      new_rake_path(master_rake_id: @rake.id),
                                    data: { toggle: "modal",
                                            target: "#newCustomRakeModal",
                                          },
                      class: "btn btn-primary btn-block" %>
        <% end %>
      <% else %>
        <%= link_to "<i class='fa fa-plus white'></i>".html_safe + " Create Customized Rake",
                    new_user_session_path,
                    class: "btn btn-primary btn-block" %>
      <% end %>
    </p>
    <div class="panel-group" id="accordion">
      <div class="panel panel-default">
        <div class="panel-heading">
          <h5 class="panel-title">
            <% href_id = "#feed" %>
            <%= link_to "News", master_rake_path(heap_type: "News") %>
            <% if params[:heap_type] == "News" %>
              <span class="pull-right">
                <%= link_to '<i class="fa fa-info"></i>'.html_safe, href_id, 
                            :data => { :toggle => "collapse" },
                            id: "feed-chevron" %>
              </span>
            <% end %>
          </h5>
        </div>
        <% if params[:heap_type] == "News" %>
          <div id="feed" class="panel-collapse collapse in">
        <% else %>
          <div id="feed" class="panel-collapse collapse">
        <% end %>
            <div class="panel-body">
            </div>
          </div>
      </div>
      <p>
        <h5><small>HEAPS</small></h5>
      </p>
      <% @heap_types.each do |ht| %>
        <div class="panel panel-default">
          <div class="panel-heading">
            <h5 class="panel-title">
              <% href_id = "#heap_" + ht.to_s %>
              <%= link_to LeafletType.find_by_leaflet_type(ht).leaflet_type_desc, master_rake_path(heap_type: ht) %>
              <% if params[:heap_type].to_i == ht && !params[:heap_type] == "News" %>
                <span class="pull-right">
                  <%= link_to '<i class="fa fa-info"></i>'.html_safe, href_id, 
                              :data => { :toggle => "collapse" },
                              id: "feed-chevron" %>
                </span>
              <% end %>
            </h5>
          </div>
          <% if params[:heap_type].to_i == ht && !params[:heap_type] == "News" %>
            <div id="heap_<%= "#{ht}" %>" class="panel-collapse collapse in">
          <% else %>
            <div id="heap_<%= "#{ht}" %>" class="panel-collapse collapse">
          <% end %>
            <div class="panel-body">
            </div>
          </div>
        </div>
      <% end %>
      <p>
        <h5><small>DASHBOARD</small></h5>
      </p>
      <div class="panel panel-default">
        <div class="panel-heading">
          <h5 class="panel-title">
            Stats
            <span class="pull-right">
              <%= link_to '<i class="fa fa-chevron-down"></i>'.html_safe, "#stats", 
                          :data => { :toggle => "collapse" },
                          id: "feed-chevron" %>
            </span>
          </h5>
        </div>
        <div id="stats" class="panel-collapse collapse">
          <div class="panel-body">
            <ul class="leaflet-list">
              <li class="rake-show-list">Number of Channels: <span class="pull-right"><%= @rake.channels.count.to_s %></span></li>
              <li class="rake-show-list">Number of Rakes: <span class="pull-right"><%= @rake.rakes.count.to_s %></span></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-6">
    <h5>
      <small>
        <% if params[:heap_type] == "News" %>
          <%= @rake.name.upcase %> | NEWS
        <% else %>
          <%= @rake.name.upcase %> | <%= LeafletType.find_by_leaflet_type(params[:heap_type].to_i).leaflet_type_desc.upcase %>
        <% end %>
      </small>
    </h5>
    <% if params[:heap_type] == "News" %>
      <%= render 'master_rakes/feed' %>
    <% else %>
      <%= render 'master_rakes/heap', locals: { leaflet_type_id: params[:heap_type] } %>
    <% end %>
  </div>
</div>

<%= render 'master_rakes/edit_category_modal' %>
<% if @custom_rake.count > 0 %>
  <%= render 'master_rakes/leaflet_save_modal' %>
<% else %>
  <%= render 'master_rakes/new_rake_modal' %>
<% end %>
