<%= render 'shared/navbar' %>

<nav>
  <ul class="nav-close-x">
    <li class="text-right"><a href="#" id="nav-close">X</a></li>
  </ul>
  <div class="panel-group" id="accordion">
    <% if !@rake.nil? %>
      <div class="panel panel-default panel-menu">
        <div class="panel-heading active panel-heading-menu">
          <h5 class="panel-title">
            <% href_id = "#master_rake" %>
            <i class="fa fa-leaf green"></i> <%= @rake.name %>
            <span class="pull-right">
              <%= link_to '<i class="fa fa-cog green"></i>'.html_safe, href_id, :data => { :toggle => "collapse" } %>
            </span>
          </h5>
          <div id="master_rake" class="panel-collapse collapse">
            <div class="panel-body menu black">
              <h5>
                <small>
                  CATEGORY
                  &nbsp;|&nbsp;
                  <%= link_to "EDIT", edit_master_rake_path(@rake),
                              data: { toggle: "modal",
                                      target: "#editCategoryModal",
                                      category: @rake.category_id } %>
                </small>
              </h5>
              <ul class="leaflet-list">
                <li class="rake-show-list">
                  <%= Category.find(@rake.category_id).desc %>
                </li>
              </ul>
              <h5>
                <small>
                  CHANNELS
                  &nbsp;|&nbsp;
                  <%= link_to "ADD RSS FEED", new_channel_path(rake_id: @rake.id, channel_type: 0),
                              data: { toggle: "modal",
                                      target: "#addRssModal",
                                      rakeid: @rake.id,
                                      channeltype: 0 },
                              class: "add-rss-feed" %>
                  &nbsp;|&nbsp;
                  <%= link_to "ADD SUBREDDIT", new_channel_path(rake_id: @rake.id, channel_type: 4),
                              data: { toggle: "modal",
                                      target: "#addSubredditModal",
                                      rakeid: @rake.id,
                                      channeltype: 4 },
                              class: "add-subreddit-feed" %>
                </small>
              </h5>
              <ul class="leaflet-list">
                <% @rake.channels.each do |c| %>
                  <li class="rake-show-list" id="<%= 'channel_' + c.id.to_s %>">
                    <span class="pull-left">
                      <% favicon_path = "http://www.google.com/s2/favicons?domain=" + c.source %>
                      <img class="media-object img-rake-show" src=<%= "#{favicon_path}" %> alt="media image">
                    </span>
                    <div class="media-body">
                      <h5 class="media-heading channel-heading">
                        <!-- <i class="fa fa-check-square-o"></i> -->
                        <%# if c.rake_channel_maps.find_by_rake_id(@rake.id).display %>
                          <%#= link_to '<i class="fa fa-check-square-o"></i>'.html_safe,
                                      toggle_channel_display_rake_path(@rake, channel: c.id, display: false) %>
                        <%# else %>
                          <%#= link_to '<i class="fa fa-square-o"></i>'.html_safe,
                                      toggle_channel_display_rake_path(@rake, channel: c.id, display: true) %>
                        <%# end %>
                        <%= c.name %>
                        <!-- <span class="pull-right">
                          <%#= link_to '<i class="fa fa-trash-o"></i>'.html_safe, remove_channel_rake_path(@rake, channel: c.id), :data => { :confirm => "Are you sure?" }, :method => :get %>
                        </span> -->
                      </h5>
                      <p>
                        <i class="fa fa-star"></i> <%= Leaflet.where("channel_id = '#{c.id}'").sum(:save_count) %>
                        <i class="fa fa-user"></i> <%= c.count_subscribers %>
                        <i class="fa fa-tasks"></i> <%= Leaflet.where("channel_id = '#{c.id}'").count %>
                      </p>
                    </div>
                  </li>
                <% end %>
              </ul>
            </div>
          </div>
        </div>
      </div>
    <% end %>
    <% if user_signed_in? %>
      <div class="panel panel-default panel-menu">
        <div class="panel-heading panel-heading-menu">
          <h5 class="panel-title">
            <%= link_to "<i class='fa fa-th-list white'></i>".html_safe + " My Rakes", rakes_path %>
          </h5>
        </div>
      </div>
    <% end %>
    <div class="panel panel-default panel-menu">
      <div class="panel-heading panel-heading-menu">
        <h5 class="panel-title">
          <% if user_signed_in? %>
            <%= link_to "<i class='fa fa-user white'></i>".html_safe + "  SIGN OUT", destroy_user_session_path, method: :delete %>
            <span class="pull-right">
              <%= link_to '<i class="fa fa-cog green"></i>'.html_safe, href_id, :data => { :toggle => "collapse" } %>
            </span>
          <% else %>
            <%= link_to "<i class='fa fa-user white'></i>".html_safe + "  SIGN IN", new_user_session_path %>
          <% end %>
        </h5>
      </div>
    </div>
  </div>
</nav>
<%= render 'master_rakes/add_rss_modal' %>
<%= render 'master_rakes/add_subreddit_modal' %>