<%= render 'shared/navbar' %>

<nav>
  <ul class="nav-close-x">
    <li class="text-right"><a href="#" id="nav-close">X</a></li>
  </ul>

  <div class="panel-group" id="accordion">

    <div class="panel panel-default panel-menu">
      <div class="panel-heading panel-heading-menu">
        <h5 class="panel-title">
          <%= link_to "<i class='fa fa-home white'></i>".html_safe + "  Home", root_path %>
        </h5>
      </div>
    </div>

    <div class="panel panel-default panel-menu">
      <div class="panel-heading panel-heading-menu">
        <% if user_signed_in? %>
          <h5 class="panel-title">
            <i class="fa fa-user white"></i> <%= current_user.username %>
            <span class="pull-right">
            <% href_id = "#user" %>
              <%= link_to '<i class="fa fa-chevron-down white"></i>'.html_safe, href_id, :data => { :toggle => "collapse" } %>
            </span>
          </h5>
      </div>
      <div id="user" class="panel-collapse collapse">
        <div class="panel-body menu black">
          <ul class="menu-list">
            <li class="rake-show-list">
              <%#= link_to "Social Accounts", authentications_path %>
            </li>
            <li class="rake-show-list">
              <%= link_to "Terms of Service", pages_path(section: "terms_of_service"), class: "purple" %>
            </li>
            <li class="rake-show-list">
              <%= link_to "Privacy Policy", pages_path(section: "privacy_policy"), class: "purple" %>
            </li>
            <li class="rake-show-list">
              <%= link_to "Sign Out", destroy_user_session_path, method: :delete, class: "purple" %>
            </li>
          </ul>
        </div>
      </div>
        <% else %>
          <%= link_to "<i class='fa fa-user white'></i>".html_safe + "  Sign in", new_user_session_path, class: "white" %>
        <% end %>
    </div>

    <% if user_signed_in? %>
      <div class="panel panel-default panel-menu">
        <div class="panel-heading panel-heading-menu">
          <h5 class="panel-title">
            <%= link_to "<i class='fa fa-th-list white'></i>".html_safe + " My Rakes", rakes_path %>
          </h5>
        </div>
      </div>
    <% end %>

    <% if !@rake.nil? %>
      <div class="panel panel-default panel-menu">
        <div class="panel-heading active panel-heading-menu">
          <h5 class="panel-title">
            <% href_id = "#master_rake" %>
            <i class="fa fa-leaf green"></i>
              <span class="rake-title">
                <%= @rake.name %>
              </span>
            <span class="pull-right">
              <%= link_to '<i class="fa fa-cog green"></i>'.html_safe, href_id, :data => { :toggle => "collapse" } %>
            </span>
          </h5>
          <div id="master_rake" class="panel-collapse collapse in">
            <div class="panel-body menu black">
              <h5>
                <small>
                  CATEGORY [<%= Category.find(@rake.category_id).desc %>]
                  <% if !current_user.nil? && current_user.admin? %>
                    <span class="pull-right-menu">
                      <%= link_to "EDIT", edit_master_rake_path(@rake),
                                  data: { toggle: "modal",
                                          target: "#editCategoryModal",
                                          category: @rake.category_id } %>
                    </span>
                  <% end %>
                </small>
              </h5>
              <h5>
                <small>
                  CHANNELS
                  <% if !current_user.nil? %>
                    <span class="pull-right-menu">
                      <%= link_to "ADD BLOG", new_channel_path(rake_id: @rake.id, channel_type: 0),
                                  data: { toggle: "modal",
                                          target: "#addRssModal",
                                          rakeid: @rake.id,
                                          channeltype: 0 },
                                  class: "add-rss-feed" %>
                      <%= link_to "ADD SUBREDDIT", new_channel_path(rake_id: @rake.id, channel_type: 4),
                                  data: { toggle: "modal",
                                          target: "#addSubredditModal",
                                          rakeid: @rake.id,
                                          channeltype: 4 },
                                  class: "add-subreddit-feed" %>
                    </span>
                  <% else %>
                    <span class="pull-right-menu">
                      <%= link_to "ADD BLOG", new_user_session_path %>
                      &nbsp;|&nbsp;
                      <%= link_to "ADD SUBREDDIT", new_user_session_path %>
                    </span>
                  <% end %>
                </small>
              </h5>
              <ul class="leaflet-list">
                <% @rake.channels.where("channel_type <> 3 AND channel_type <> 5").each do |c| %>
                  <li class="channel-list" id="<%= 'channel_' + c.id.to_s %>">
                    <span class="pull-left">
                      <% favicon_path = "http://www.google.com/s2/favicons?domain=" + c.source %>
                      <img class="media-object img-rake-show" src=<%= "#{favicon_path}" %> alt="media image">
                    </span>
                    <div class="media-body">
                      <h5 class="media-heading channel-heading">
                        <!-- <i class="fa fa-check-square-o"></i> -->
                        <%# if c.rake_channel_maps.find_by_rake_id(@rake.id).display %>
                          <%#= link_to '<i class="fa fa-check-square-o"></i>'.html_safe,
                                      toggle_channel_display_rake_path(@rake, channel: c.id, display: false) %>
                        <%# else %>
                          <%#= link_to '<i class="fa fa-square-o"></i>'.html_safe,
                                      toggle_channel_display_rake_path(@rake, channel: c.id, display: true) %>
                        <%# end %>
                        <% channel_name = c.name %>
                        <% if channel_name == "Title not available." %>
                          <% channel_name = c.source %>
                        <% end %>
                        <%= channel_name %>
                        <span class="pull-right">
                          <% if user_signed_in? && !@custom_rake.first.nil? %>
                            <% if !@custom_rake.first.channels.include? c %>
                              <%= link_to '<i class="fa fa-plus"></i>'.html_safe,
                                    add_channel_rake_path(@custom_rake.first.id, channel: c.id),
                                    title: "Add Channel to own Rake" %>
                              &nbsp;|&nbsp;
                            <% end %>
                          <% end %>
                          <% if !current_user.nil? && current_user.admin? %>
                            <%= link_to '<i class="fa fa-trash-o"></i>'.html_safe,
                                        remove_channel_master_rake_path(@rake, channel: c.id),
                                        :data => { :confirm => "Are you sure?" },
                                        :method => :get %>
                          <% end %>
                        </span>
                      </h5>
                      <p class="channel-info">
                        <i class="fa fa-star"></i> <%= Leaflet.where("channel_id = '#{c.id}'").sum(:save_count) %>
                        <i class="fa fa-user"></i> <%= c.count_subscribers %>
                        <i class="fa fa-tasks"></i> <%= Leaflet.where("channel_id = '#{c.id}'").count %>
                      </p>
                    </div>
                  </li>
                <% end %>
              </ul>
              <% if user_signed_in? %>
                <% if @rake.created_by == current_user.id && @rake.rakes.count == 0 %>
                  <p>
                    <span class="pull-right">
                      <%= link_to "Delete Master Rake", master_rake_path(@rake),
                                    :data => { :confirm => "Are you sure?" }, 
                                    :method => :delete,
                                    class: "btn btn-default btn-xs" %>
                    </span>
                  </p>
                <% end %>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</nav>
<%= render 'master_rakes/add_rss_modal' %>
<%= render 'master_rakes/add_subreddit_modal' %>