<div class="panel panel-default">
  <div class="panel-heading panel-overview">
    <h5 class="panel-title">
      <a data-toggle="collapse" data-parent="#accordion-show" 
         href="#collapse-overview">
         Overview
      </a>
    </h5>
  </div>
  <div class="panel-collapse collapse in" id="collapse-overview">
    <div class="panel-body">
      <span class="channel-title">Recently added Channels:</span>
      <br>
      <ul class="leaflet-list">
        <% @rake.channels.where("channel_type <> 3 AND channel_type <> 5").order("created_at DESC").limit(5).each do |c| %>
          <% if user_signed_in? && !@custom_rake.first.nil? %>
            <% if !@custom_rake.first.channels.include? c %>
              <li class="channel-list" id="<%= 'channel_' + c.id.to_s %>">
                <span class="pull-left">
                  <% if c.channel_type == 4 %>
                    <%= image_tag "reddit-32.png", size: "16x16", class: "media-object img-feed-show" %>
                  <% elsif c.channel_type == 3 %>
                    <%= image_tag "rakepage_logo_transparent_32x32.png", size: "16x16", class: "media-object img-feed-show" %>
                  <% else %>
                    <% favicon_path = "http://www.google.com/s2/favicons?domain=" + c.source %>
                    <img class="media-object img-feed-show" src=<%= "#{favicon_path}" %> alt="media image">
                  <% end %>
                </span>
                <div class="media-body">
                  <h5 class="media-heading channel-heading">
                    <% channel_name = c.name %>
                    <% if channel_name == "Title not available." %>
                      <% channel_name = c.source %>
                    <% end %>
                    <%= channel_name %>
                    <span class="pull-right">
                    <%= link_to '<i class="fa fa-plus"></i>'.html_safe,
                          add_channel_rake_path(@custom_rake.first.id, channel: c.id),
                          title: "Add Channel to own Rake" %>
                    </span>
                  </h5>
                  <p class="channel-info">
                    <i class="fa fa-star" title="Saved count from this channel"></i> <%= Leaflet.where("channel_id = '#{c.id}'").sum(:save_count) %>
                    <i class="fa fa-user" title="Count of channel users"></i> <%= c.count_subscribers %>
                    <i class="fa fa-tasks" title="Count of current posts"></i> <%= Leaflet.where("channel_id = '#{c.id}'").count %>
                  </p>
                </div>
              </li>
            <% end %>
          <% else %>
            <li class="channel-list" id="<%= 'channel_' + c.id.to_s %>">
              <span class="pull-left">
                <% if c.channel_type == 4 %>
                  <%= image_tag "reddit-32.png", size: "16x16", class: "media-object img-feed-show" %>
                <% elsif c.channel_type == 3 %>
                  <%= image_tag "rakepage_logo_transparent_32x32.png", size: "16x16", class: "media-object img-feed-show" %>
                <% else %>
                  <% favicon_path = "http://www.google.com/s2/favicons?domain=" + c.source %>
                  <img class="media-object img-feed-show" src=<%= "#{favicon_path}" %> alt="media image">
                <% end %>
              </span>
              <div class="media-body">
                <h5 class="media-heading channel-heading">
                  <%= c.name %>
                </h5>
                <p class="channel-info">
                    <i class="fa fa-star" title="Saved count from this channel"></i> <%= Leaflet.where("channel_id = '#{c.id}'").sum(:save_count) %>
                    <i class="fa fa-user" title="Count of channel users"></i> <%= c.count_subscribers %>
                    <i class="fa fa-tasks" title="Count of current posts"></i> <%= Leaflet.where("channel_id = '#{c.id}'").count %>
                </p>
              </div>
            </li>
          <% end %>
        <% end %>
      </ul>

      <% if user_signed_in? %>
        <% if !@custom_rake.nil? && !@custom_rake.empty? %>
          <%= link_to "<i class='fa fa-leaf white'></i>".html_safe + " Show my Rake",
                      rake_path(@custom_rake.first),
                      class: "btn btn-xs btn-primary" %>
        <% else %>
          <%= link_to "<i class='fa fa-plus white'></i>".html_safe + " Create Customized Rake",
                      new_rake_path(master_rake_id: @rake.id),
                                    data: { toggle: "modal",
                                            target: "#newCustomRakeModal",
                                          },
                      class: "btn btn-xs btn-primary" %>
        <% end %>
      <% else %>
        <%= link_to "<i class='fa fa-plus white'></i>".html_safe + " Create Customized Rake",
                    new_user_session_path,
                    class: "btn btn-primary btn-block" %>
      <% end %>
      <%= link_to "Show Master Rakes", master_rakes_path, class: "btn btn-xs btn-primary" %>
      <% if user_signed_in? %>
        <% if @rake.created_by == current_user.id && @rake.rakes.count == 0 %>
          <%= link_to "Delete Master Rake", master_rake_path(@rake),
                        :data => { :confirm => "Are you sure?" }, 
                        :method => :delete,
                        class: "btn btn-default btn-xs" %>
        <% end %>
      <% end %>

    </div>
  </div>
</div>