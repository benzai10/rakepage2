<%= render 'shared/navbar' %>

<nav>
  <ul class="nav-close-x">
    <li class="text-right"><a href="#" id="nav-close">X</a></li>
  </ul>
  <div class="panel-group" id="accordion">
    <div class="panel panel-default panel-menu">
      <div class="panel-heading panel-heading-menu">
        <h5 class="panel-title">
          <%= link_to "<i class='fa fa-home white'></i>".html_safe + "  HOME", root_path %>
        </h5>
      </div>
    </div>

    <div class="panel panel-default panel-menu">
      <div class="panel-heading panel-heading-menu">
        <h5 class="panel-title">
          <%= link_to "<i class='fa fa-globe white'></i>".html_safe + "  Rake Templates", master_rakes_path, class: "rake_title" %>
        </h5>
      </div>
    </div>

    <div class="panel panel-default panel-menu">
      <div class="panel-heading panel-heading-menu">
        <h5 class="panel-title">
          <%= link_to "<i class='fa fa-sitemap white'></i>".html_safe + "  My Rakes", rakes_path, class: "rake_title" %>
        </h5>
      </div>
    </div>

    <% if !@rake.nil? %>
      <div class="panel-heading active panel-heading-menu">
        <h5 class="panel-title">
          <% href_id = "#rake" %>
          <i class='fa fa-leaf green'></i>&nbsp;<%= @rake.name %>
          <span class="pull-right">
            <%= link_to '<i class="fa fa-cog green"></i>'.html_safe, href_id, :data => { :toggle => "collapse" } %>
          </span>
        </h5>
        <div id="rake" class="panel-collapse collapse">
          <div class="panel-body menu black">
            <%= bootstrap_form_for(@rake) do |f| %>
              <%= f.text_field :rake_filters, class: "tokenize", value: @rake_filter %>
              <%= f.submit "Refresh", class: "btn btn-primary" %>
            <% end %>
            <br>
            Channels:
            <ul class="leaflet-list">
              <% @rake.channels.each do |c| %>
                <li class="rake-show-list" id="<%= 'channel_' + c.id.to_s %>">
                  <span class="pull-left" >
                    <% favicon_path = "http://www.google.com/s2/favicons?domain=" + c.source %>
                    <img class="media-object img-rake-show" src=<%= "#{favicon_path}" %> alt="media image">
                  </span>
                  <div class="media-body">
                    <h5 class="media-heading channel-heading">
                      <% if c.rake_channel_maps.find_by_rake_id(@rake.id).display %>
                        <%= link_to '<i class="fa fa-check-square-o"></i>'.html_safe,
                                    toggle_channel_display_rake_path(@rake, channel: c.id, display: false) %>
                      <% else %>
                        <%= link_to '<i class="fa fa-square-o"></i>'.html_safe,
                                    toggle_channel_display_rake_path(@rake, channel: c.id, display: true) %>
                      <% end %>
                      <%= c.name %>
                      <span class="pull-right">
                        <%= link_to '<i class="fa fa-trash-o"></i>'.html_safe, remove_channel_rake_path(@rake, channel: c.id), :data => { :confirm => "Are you sure?" }, :method => :get %>
                      </span>
                    </h5>
                    <p>
                      <i class="fa fa-star"></i> <%= Leaflet.where("channel_id = '#{c.id}'").sum(:save_count) %>
                      <i class="fa fa-user"></i> <%= c.count_subscribers %>
                      <i class="fa fa-tasks"></i> <%= Leaflet.where("channel_id = '#{c.id}'").count %>
                    </p>
                  </div>
                </li>
              <% end %>
            </ul>
            <%= link_to "Add Channel", new_channel_path(rake_id: @rake.id) %>
          </div>
        </div>
      </div>
    <% end %>

    <div class="panel panel-default panel-menu">
      <div class="panel-heading active panel-heading-menu">
        <h5 class="panel-title">
          <% if user_signed_in? %>
            <i class="fa fa-user green"></i> <%= current_user.username %>
            <span class="pull-right">
            <% href_id = "#user" %>
              <%= link_to '<i class="fa fa-cog green"></i>'.html_safe, href_id, :data => { :toggle => "collapse" } %>
            </span>
            <div id="user" class="panel-collapse collapse">
              <div class="panel-body menu black">
              <%= link_to "Social Accounts", authentications_path %>
              <%= link_to "Sign Out", destroy_user_session_path, method: :delete, class: "purple" %>
              </div>
            </div>
          <% else %>
            <%= link_to "<i class='fa fa-user white'></i>".html_safe + "  SIGN IN", new_user_session_path %>
          <% end %>
        </h5>
      </div>
    </div>

  </div>

</nav>