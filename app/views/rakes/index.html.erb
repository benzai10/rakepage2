<% if !@category.nil? %>
  <% title @category.desc + " Recommendations" %>
<% end %>
<div class="container-fluid">
<%= render 'rakes/rakes_menu' %>
<div class="row">
  <div class="col-md-3">
    <% if user_signed_in? && @rakes.first.user_id == current_user.id %>
      <h5><small>
        MY RAKES | <%= link_to '<i class="fa fa-arrow-right"></i> MASTER RAKES'.html_safe, master_rakes_path %>
      </small></h5>
    <% else %>
      <h5><small><%= User.find(@rakes.first.user_id).username.upcase %>'S RAKES | CATEGORIES</small></h5>
    <% end %>
    <% if !flash.empty? %>
      <%= render 'shared/flash_message' %>
    <% end %>
    <div class="panel-group" id="accordion">
      <div class="panel panel-default">
        <div class="panel-heading">
          <h5 class="panel-title">
            <%= link_to "Front Page", rakes_path %>
          </h5>
        </div>
        <% if @category.nil? %>
          <div class="panel-collapse collapse in">
        <% else %>
          <div class="panel-collapse collapse">
        <% end %>
          <div class="panel-body channel-heading">
            To create a new rake, check first for existing master rakes. If you don't find it, create a new master rake and from there you can easily copy it to have your own customizable rake.
          </div>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">
          <h5 class="panel-title">
            Categories
            <span class="pull-right">
              <i class="fa fa-chevron-down"></i>
            </span>
          </h5>
        </div>
        <div class="panel-body">
          <ul class="category-list">
            <% @categories.each do |c| %>
              <li>
                <%= link_to c.desc, rakes_path(category_id: c.id) %>
                <small>
                  &nbsp;<%= @rakes.where("master_rake_id IN (?)", MasterRake.where(category_id: c.id).pluck(:id)).count.to_s %>
                </small>
              </li>
            <% end %>
          </ul>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-6">
    <% if !@category.nil? %>
      <h5><small><%= @category.desc.upcase %></small></h5>
      <div class="row">
        <% master_rake_ids = MasterRake.where("category_id = ?", @category.id).pluck(:id) %>
        <% @rakes.where("master_rake_id IN (?)", master_rake_ids).each do |r| %>
          <div class="col-md-6">
            <div class="thumbnail">
              <%= link_to rake_path(r.id) do %>
                <% master_rake = MasterRake.find(r.master_rake_id) %>
                <div class="caption load-rake" value="<%= r.id %>">
                  <% if master_rake.image_url.nil? || master_rake.image_url.empty? %>
                    <%= image_tag("no_image.png") %>
                  <% else %>
                    <%= image_tag(master_rake.image_url) %>
                  <% end %>
                  <div class="rake-caption">
                    <%= r.name %>
                    <span id="load-rake-<%= "#{r.id.to_s}" %>"></span>
                  </div>
                </div>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <h5><small>FRONT PAGE</small></h5>
      <%= render 'front_page' %>
    <% end %>
  </div>
</div>
<%#= render 'rakes/social_modal' %>
</div>