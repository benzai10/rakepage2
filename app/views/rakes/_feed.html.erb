<% if !flash.empty? %>
  <%= render 'shared/flash_message' %>
<% end %>
<ul id="feed-list" class="leaflet-list">
  <% @feed_leaflets.each do |l| %>
    <li class="rake-show-list">
      <a class="pull-left" href="#">
        <% favicon_path = "http://www.google.com/s2/favicons?domain=" + Channel.find(l.channel_id).source %>
        <img class="media-object img-feed-show" src=<%= "#{favicon_path}" %> alt="media image">
      </a>
      <div class="media-body">
        <span class="feed-timestamp">
          <%= Channel.find(l.channel_id).name %>
          <% if l.leaflet_type_id != 0 %>
            &nbsp;|&nbsp;
            <%= LeafletType.find_by_leaflet_type(l.leaflet_type_id).leaflet_type_desc %>
            &nbsp;|&nbsp;
            <% if !l.created_by.nil? %>
              added by <%= User.find(l.created_by).username %>
            <% end %>
          <% end %>
          <span class="pull-right-menu">
            <% if !l.published_at.nil? %>
              <%= time_ago_in_words(l.published_at) %> ago 
            <% else %>
              <%= time_ago_in_words(l.created_at) %> ago 
            <% end %>
          </span>
        </span>
        <br>
        <span class="leaflet-title">
          <%= link_to l.title.html_safe, l.url, class: "external", value: l.id, target: "_blank" %>
        </span>
        <p class="feed-body"><%= raw l.content unless l.content == "No more content available." %></p>
        <i class="fa fa-eye"></i> <span class="v_count_<%= l.id %>"><%= l.view_count %></span>
        &nbsp;|&nbsp;
        <i class="fa fa-star"></i> <span class="s_count_<%= l.id %>"><%= l.save_count %></span>
        &nbsp;|&nbsp;
        <i class="fa fa-eraser"></i> <span class="d_count_<%= l.id %>"><%= l.delete_count %></span>
        <span class="pull-right">
          <span id="<%= 'feed-heart-icon-' + l.id.to_s %>">
            <% if user_signed_in? %>
              <% if History.where("user_id = ?", current_user.id).liked.pluck(:leaflet_id).include? l.id %>
                <i class="fa fa-heart"></i>
              <% else %>
                <i class="fa fa-heart-o like" value=<%= l.id %>></i>
              <% end %>
            <% else %>
              <i class="fa fa-heart-o"></i>
            <% end %>
          </span>
          <span class="l_count_<%= l.id %>"><%= l.like_count %></span>
          <span id="<%= 'feed_star_icon_' + l.id.to_s %>">
            <% if @heap_leaflets.include? l %>
              &nbsp;|&nbsp;
              <i class="fa fa-star"></i>
            <% else %>
              <% if user_signed_in? %>
                &nbsp;|&nbsp;
                <% if @rake.user_id == current_user.id %>
                  <%= link_to '<i class="fa fa-save"></i>'.html_safe, add_leaflet_rake_path(@rake), 
                              data: { toggle: "modal", target: "#myModal", id: l.id, title: l.title }, class: "leaflet-save" %>
                <% else %>
                  <% if !@other_user_rake.nil? %>
                    <%= link_to '<i class="fa fa-save"></i>'.html_safe, add_leaflet_rake_path(@other_user_rake), 
                                data: { toggle: "modal", target: "#myModal", id: l.id, title: l.title }, class: "leaflet-save" %>
                  <% else %>
                    <%= link_to '<i class="fa fa-save"></i>'.html_safe, new_rake_path, 
                                data: { toggle: "modal", target: "#newCustomRakeAddLeafletModal", id: l.id, title: l.title }, class: "leaflet-save" %>

                  <% end %>
                <% end %>
              <% end %>
            <% end %>
          </span>
        </span>
      </div>
      <hr>
    </li>
  <% end %>
</ul>
<%= paginate @feed_leaflets %>